[build]

# Ordinarily we would just set this but: we don't want to break regular
# `cargo doc` for developers that don't have a nightly toolchain installed.
# rustdocflags = ["--cfg", "docs"]
#
# Instead, we provide the `docs` alias.
#
# Similar to regular lints and clippy lints (below), we want to have one place
# to stick our rustdoc lints.
#
# Sticking these in `rustdocflags` has two downsides:
#   - these lints will not show up in your editor!
#   - these lints block building docs!
#
# Unfortunately, I don't currently know of a better way.
#
# As a stopgap, we _do_ pass rustdoc `--cap-lints allow` in the `cargo docs`
# alias below but that requires nightly Rust.
rustdocflags = [
    ### [rustdoc] https://doc.rust-lang.org/rustdoc/lints.html
    "--deny", "rustdoc::broken_intra_doc_links",
    "--deny", "missing-docs",
    "--deny", "rustdoc::missing_crate_level_docs",
    "--deny", "rustdoc::bare_urls",

    # NOTE: `cargo` still sets `--cap-lints` when building docs for deps so
    # these lints don't trigger there/break the docs build.
]

# TODO: in CI, set RUSTDOCFLAGS to `--cap-lints forbid`.
# TODO: in CI, run rustdoc with "--show-coverage"

[alias]
# Requires `nightly` Rust!
docs = [
    "-Z", "unstable-options",
    "-Z", "rustdoc-scrape-examples=examples",
    '--config=build.rustdocflags=["--cfg", "docs", "-Zunstable-options", "--show-type-layout", "--cap-lints=allow"]', # `--scrape-examples`, '--check-cfg', '--generate-link-to-definition'
    "doc", "--workspace", "--document-private-items", "--all-features", # "--bins", "--examples",
]
# Stable equivalent of the above.
docs-stable = [
    "doc", "--workspace", "--document-private-items", "--all-features", # "--bins", "--examples"
]

# We put this list here instead of in `lib.rs`/`main.rs`/CI workflows for a
# couple of reasons:
#   1) We'd like to not have to duplicate/update this list in every crate in
#      this workspace
#   2) For local development, we want running these lints to be _opt in_.
#      Having, for example, missing documentation prevent you from compiling
#      and testing while you're still figuring out how to implement something
#      is counterproductive.
#
#      These lints *are* enforced by CI however we don't want to put this list
#      in the CI workflow definition either because: we still want to have an
#      easy way for developers to run exactly the checks CI will run, locally.
#
# The downside to this approach, as detailed in `.vscode/core.code-workspace`,
# is that this alias does not play well with rust analyzer so there isn't an
# easy way for developers to see these errors in their editor.
#
# In the future we may want to switch to:
#   - clippy.toml, when it is implemented
#     + https://github.com/rust-lang/rust-clippy/issues/1313
#     + https://github.com/rust-lang/cargo/issues/5034
#   - `cargo-cranky`, if we decide we're okay requiring developers to install it
#     + https://github.com/ericseppanen/cargo-cranky
#     + this supports rustc lints and also plays well with `rust-analyzer`
clippy-all = ["clippy", "--all", "--all-features", "--all-targets", "--",
    ### [rustc] allow by default lints: https://doc.rust-lang.org/rustc/lints/listing/allowed-by-default.html

    ### [rustc] warn by default lints: https://doc.rust-lang.org/rustc/lints/listing/warn-by-default.html

    ### [rustc] deny by default lints: https://doc.rust-lang.org/rustc/lints/listing/deny-by-default.html

]
lint = ["clippy-all"]

